<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediPartners Ledger App</title>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Space Grotesk', sans-serif;
        }
        .neubrutalism {
            border: 4px solid #000;
            box-shadow: 8px 8px 0px #000;
            transition: all 0.2s ease;
        }
        .neubrutalism:hover {
            transform: translate(-3px, -3px);
            box-shadow: 11px 11px 0px #000;
        }
        .bg-medical {
            background-color: #FFD166;
        }
        .tab-active {
            background-color: white;
            border-bottom: 0;
            font-weight: bold;
        }
        .input-neubrutalism {
            border: 3px solid #000;
            padding: 0.5rem;
            width: 100%;
            background-color: white;
        }
        .input-neubrutalism:focus {
            outline: none;
            background-color: #f0f0f0;
        }
        .select-neubrutalism {
            border: 3px solid #000;
            padding: 0.5rem;
            width: 100%;
            background-color: white;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }
        /* For date inputs */
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: invert(0.5);
        }
        
        /* Table styling */
        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        /* Custom checkbox */
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            border: 2px solid black;
            appearance: none;
            -webkit-appearance: none;
            background-color: white;
        }
        
        input[type="checkbox"]:checked {
            background-color: black;
            position: relative;
        }
        
        input[type="checkbox"]:checked::after {
            content: 'âœ“';
            color: white;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body class="bg-medical min-h-screen">
    <nav class="p-4">
        <div class="container mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <h1 class="text-3xl font-bold neubrutalism bg-white p-2">MediPartners</h1>
                <div class="flex flex-wrap gap-3">
                    <a href="#ledger" class="neubrutalism bg-white p-2 inline-block">Ledger</a>
                    <a href="#partners" class="neubrutalism bg-white p-2 inline-block">Partners</a>
                    <a href="#contact" class="neubrutalism bg-white p-2 inline-block">Contact</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <!-- Ledger App Section -->
        <section class="mb-12" id="ledger">
            <div class="neubrutalism bg-white p-6 md:p-8 mb-8">
                <h2 class="text-4xl font-bold mb-4">Financial Ledger App</h2>
                <p class="text-xl mb-6">Track transactions, manage finances, and set reminders for your medical supplies.</p>
                
                <!-- Tabs -->
                <div class="flex flex-wrap border-b-3 border-black mb-6 overflow-x-auto">
                    <button id="tab-add" class="tab-active border-t-3 border-l-3 border-r-3 px-3 md:px-4 py-2 border-black whitespace-nowrap">Add Entry</button>
                    <button id="tab-view" class="bg-gray-100 border-3 border-black px-3 md:px-4 py-2 whitespace-nowrap">View Records</button>
                    <button id="tab-reports" class="bg-gray-100 border-3 border-black px-3 md:px-4 py-2 whitespace-nowrap">Reports</button>
                    <button id="tab-reminders" class="bg-gray-100 border-3 border-black px-3 md:px-4 py-2 whitespace-nowrap">Reminders</button>
                </div>
                
                <!-- Add Entry Form -->
                <div id="add-entry-section" class="tab-content">
                    <form id="addEntryForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block mb-2 font-bold">Person/Company Name</label>
                            <input type="text" id="personName" class="input-neubrutalism" required>
                        </div>
                        <div>
                            <label class="block mb-2 font-bold">Amount ($)</label>
                            <input type="number" id="amount" class="input-neubrutalism" min="0" step="0.01" required>
                        </div>
                        <div>
                            <label class="block mb-2 font-bold">Transaction Type</label>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="neubrutalism p-2 cursor-pointer" id="cash-option">
                                    <input type="radio" name="transactionType" id="cash" value="cash" checked class="mr-2">
                                    <label for="cash" class="cursor-pointer">Cash</label>
                                </div>
                                <div class="neubrutalism p-2 cursor-pointer" id="credit-option">
                                    <input type="radio" name="transactionType" id="credit" value="credit" class="mr-2">
                                    <label for="credit" class="cursor-pointer">Credit</label>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block mb-2 font-bold">Date</label>
                            <input type="date" id="entryDate" class="input-neubrutalism" required>
                        </div>
                        <div>
                            <label class="block mb-2 font-bold">Category</label>
                            <select id="category" class="select-neubrutalism">
                                <option value="supplies">Medical Supplies</option>
                                <option value="equipment">Equipment</option>
                                <option value="pharma">Pharmaceuticals</option>
                                <option value="services">Services</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-2 font-bold">Description</label>
                            <textarea id="description" class="input-neubrutalism" rows="2"></textarea>
                        </div>
                        <div>
                            <label class="block mb-2 font-bold">Set Payment Reminder?</label>
                            <div class="flex items-center mb-2">
                                <input type="checkbox" id="setReminder" class="mr-2 h-5 w-5 neubrutalism">
                                <span>Yes, set a reminder</span>
                            </div>
                        </div>
                        <div id="reminderFields" class="hidden">
                            <label class="block mb-2 font-bold">Reminder Date & Time</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="date" id="reminderDate" class="input-neubrutalism">
                                <input type="time" id="reminderTime" class="input-neubrutalism">
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="neubrutalism bg-black text-white px-6 py-3 w-full md:w-auto">
                                <i class="bi bi-plus-circle mr-2"></i>Add Transaction
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- View Records Section -->
                <div id="view-records-section" class="tab-content hidden">
                    <div class="mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="md:col-span-2">
                                <label class="block mb-2 font-bold">Search</label>
                                <div class="flex">
                                    <input type="text" id="searchInput" class="input-neubrutalism rounded-r-none" placeholder="Search by name, amount, etc.">
                                    <button id="searchBtn" class="bg-black text-white px-4 border-3 border-black">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label class="block mb-2 font-bold">Financial Year</label>
                                <select id="financialYear" class="select-neubrutalism">
                                    <option value="2024-2025">2024-2025</option>
                                    <option value="2023-2024">2023-2024</option>
                                    <option value="2022-2023">2022-2023</option>
                                </select>
                            </div>
                            <div>
                                <label class="block mb-2 font-bold">Filter Type</label>
                                <select id="filterType" class="select-neubrutalism">
                                    <option value="all">All Transactions</option>
                                    <option value="cash">Cash Only</option>
                                    <option value="credit">Credit Only</option>
                                </select>
                            </div>
                            <div class="md:col-span-4">
                                <button id="applyFilters" class="neubrutalism bg-black text-white px-4 py-3 w-full md:w-auto">
                                    <i class="bi bi-funnel mr-1"></i> Apply Filters
                                </button>
                                <button id="clearFilters" class="neubrutalism bg-white text-black border-black px-4 py-3 w-full md:w-auto mt-2 md:mt-0 md:ml-2">
                                    <i class="bi bi-x-circle mr-1"></i> Clear Filters
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto mt-4 neubrutalism bg-white p-4">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">Date</th>
                                    <th class="p-3 text-left">Name</th>
                                    <th class="p-3 text-left">Amount</th>
                                    <th class="p-3 text-left">Type</th>
                                    <th class="p-3 text-left">Category</th>
                                    <th class="p-3 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsTable">
                                <!-- Transactions will be added here -->
                                <tr class="border-b border-gray-200">
                                    <td colspan="6" class="p-4 text-center">No transactions found. Add one to get started!</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Reports Section -->
                <div id="reports-section" class="tab-content hidden">
                    <div class="mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block mb-2 font-bold">Select Month</label>
                                <select id="reportMonth" class="select-neubrutalism">
                                    <option value="0">January</option>
                                    <option value="1">February</option>
                                    <option value="2">March</option>
                                    <option value="3">April</option>
                                    <option value="4">May</option>
                                    <option value="5">June</option>
                                    <option value="6">July</option>
                                    <option value="7">August</option>
                                    <option value="8">September</option>
                                    <option value="9">October</option>
                                    <option value="10">November</option>
                                    <option value="11">December</option>
                                </select>
                            </div>
                            <div>
                                <label class="block mb-2 font-bold">Select Year</label>
                                <select id="reportYear" class="select-neubrutalism">
                                    <option value="2024">2024</option>
                                    <option value="2023">2023</option>
                                    <option value="2022">2022</option>
                                </select>
                            </div>
                            <div class="md:col-span-2 self-end">
                                <button id="generateReport" class="neubrutalism bg-black text-white px-4 py-3 w-full">
                                    <i class="bi bi-bar-chart-fill mr-1"></i> Generate Report
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="neubrutalism bg-gray-50 p-4">
                            <h3 class="font-bold text-xl mb-4">Monthly Transaction Summary</h3>
                            <canvas id="monthlyChart" height="300"></canvas>
                        </div>
                        <div class="neubrutalism bg-gray-50 p-4">
                            <h3 class="font-bold text-xl mb-4">Cash vs Credit Balance</h3>
                            <canvas id="balanceChart" height="300"></canvas>
                        </div>
                    </div>
                    
                    <div class="mt-6 neubrutalism bg-gray-50 p-4">
                        <h3 class="font-bold text-xl mb-4">Monthly Statistics</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="neubrutalism bg-yellow-100 p-4">
                                <h4 class="font-bold">Total Transactions</h4>
                                <p id="totalTransactions" class="text-2xl font-bold">0</p>
                            </div>
                            <div class="neubrutalism bg-green-100 p-4">
                                <h4 class="font-bold">Cash Transactions</h4>
                                <p id="totalCash" class="text-2xl font-bold">$0.00</p>
                            </div>
                            <div class="neubrutalism bg-red-100 p-4">
                                <h4 class="font-bold">Credit Transactions</h4>
                                <p id="totalCredit" class="text-2xl font-bold">$0.00</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reminders Section -->
                <div id="reminders-section" class="tab-content hidden">
                    <div class="mb-6">
                        <h3 class="font-bold text-xl mb-4">Upcoming Reminders</h3>
                        <div id="remindersContainer" class="space-y-4">
                            <!-- Reminders will be added here -->
                            <div class="neubrutalism bg-yellow-50 p-4">
                                <p class="text-center">No reminders set. Add a transaction with a reminder to see it here!</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h3 class="font-bold text-xl mb-4">Completed Reminders</h3>
                        <div id="completedRemindersContainer" class="space-y-4">
                            <div class="neubrutalism bg-green-50 p-4">
                                <p class="text-center">No completed reminders yet.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Partners Section -->
        <section class="mb-12">
            <div class="neubrutalism bg-white p-8" id="partners">
                <h3 class="text-2xl font-bold mb-6">Our Partner Companies</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="neubrutalism bg-yellow-200 p-4">
                        <h4 class="font-bold">MediTech Solutions</h4>
                        <p>Surgical Equipment</p>
                    </div>
                    <div class="neubrutalism bg-green-200 p-4">
                        <h4 class="font-bold">HealthCare Plus</h4>
                        <p>Pharmaceutical Supplies</p>
                    </div>
                    <div class="neubrutalism bg-red-200 p-4">
                        <h4 class="font-bold">BioMed Corp</h4>
                        <p>Diagnostic Equipment</p>
                    </div>
                    <div class="neubrutalism bg-blue-200 p-4">
                        <h4 class="font-bold">LifeScience Labs</h4>
                        <p>Research Equipment</p>
                    </div>
                    <div class="neubrutalism bg-purple-200 p-4">
                        <h4 class="font-bold">CarePlus Medical</h4>
                        <p>Patient Care Products</p>
                    </div>
                </div>
                <button onclick="downloadPartnersList()" class="neubrutalism bg-black text-white px-6 py-3 mt-8">
                    <i class="bi bi-download mr-2"></i>Download Partners List
                </button>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="neubrutalism bg-white p-8">
            <h3 class="text-2xl font-bold mb-6">Contact Us</h3>
            <form id="contactForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block mb-2 font-bold">Name</label>
                    <input type="text" class="input-neubrutalism" required>
                </div>
                <div>
                    <label class="block mb-2 font-bold">Email</label>
                    <input type="email" class="input-neubrutalism" required>
                </div>
                <div class="md:col-span-2">
                    <label class="block mb-2 font-bold">Message</label>
                    <textarea class="input-neubrutalism" rows="4" required></textarea>
                </div>
                <div class="md:col-span-2">
                    <button type="submit" class="neubrutalism bg-black text-white px-6 py-3">Send Message</button>
                </div>
            </form>
        </section>
    </main>

    <footer class="container mx-auto p-4 text-center">
        <p class="neubrutalism bg-white p-2 inline-block">Â© 2024 MediPartners. All rights reserved.</p>
    </footer>

    <!-- Edit Transaction Modal -->
    <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white neubrutalism p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Edit Transaction</h3>
                <button id="closeEditModal" class="text-2xl">&times;</button>
            </div>
            <form id="editEntryForm" class="space-y-4">
                <input type="hidden" id="editId">
                <div>
                    <label class="block mb-2 font-bold">Person/Company Name</label>
                    <input type="text" id="editPersonName" class="input-neubrutalism" required>
                </div>
                <div>
                    <label class="block mb-2 font-bold">Amount ($)</label>
                    <input type="number" id="editAmount" class="input-neubrutalism" min="0" step="0.01" required>
                </div>
                <div>
                    <label class="block mb-2 font-bold">Transaction Type</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="neubrutalism p-2">
                            <input type="radio" name="editTransactionType" id="editCash" value="cash" class="mr-2">
                            <label for="editCash">Cash</label>
                        </div>
                        <div class="neubrutalism p-2">
                            <input type="radio" name="editTransactionType" id="editCredit" value="credit" class="mr-2">
                            <label for="editCredit">Credit</label>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block mb-2 font-bold">Date</label>
                    <input type="date" id="editEntryDate" class="input-neubrutalism" required>
                </div>
                <div>
                    <label class="block mb-2 font-bold">Category</label>
                    <select id="editCategory" class="select-neubrutalism">
                        <option value="supplies">Medical Supplies</option>
                        <option value="equipment">Equipment</option>
                        <option value="pharma">Pharmaceuticals</option>
                        <option value="services">Services</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-2 font-bold">Description</label>
                    <textarea id="editDescription" class="input-neubrutalism" rows="2"></textarea>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" id="cancelEdit" class="neubrutalism bg-red-500 text-white px-4 py-2">
                        Cancel
                    </button>
                    <button type="submit" class="neubrutalism bg-black text-white px-4 py-2">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Store ledger entries
        let ledgerEntries = [];
        let reminders = [];
        let editingId = null;
        
        // Current date for default values
        const today = new Date();
        const formattedDate = today.toISOString().split('T')[0];
        document.getElementById('entryDate').value = formattedDate;
        if (document.getElementById('reminderDate')) {
            document.getElementById('reminderDate').value = formattedDate;
        }

        // Set the current month in reports section
        document.getElementById('reportMonth').value = today.getMonth();
        document.getElementById('reportYear').value = today.getFullYear();
        
        // Tab functionality
        const tabs = ['add', 'view', 'reports', 'reminders'];
        tabs.forEach(tab => {
            document.getElementById(`tab-${tab}`).addEventListener('click', () => {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Show selected tab content
                const tabContent = document.getElementById(`${tab}-entry-section`) || 
                                document.getElementById(`${tab}-records-section`) || 
                                document.getElementById(`${tab}-section`);
                if (tabContent) {
                    tabContent.classList.remove('hidden');
                }
                
                // Update tab styles
                tabs.forEach(t => {
                    const tabEl = document.getElementById(`tab-${t}`);
                    tabEl.classList.remove('tab-active');
                    tabEl.classList.add('bg-gray-100');
                });
                
                const activeTab = document.getElementById(`tab-${tab}`);
                activeTab.classList.add('tab-active');
                activeTab.classList.remove('bg-gray-100');
                
                // Refresh content when switching to tabs
                if (tab === 'view') {
                    refreshTransactionsTable();
                } else if (tab === 'reports') {
                    generateMonthlyReport();
                } else if (tab === 'reminders') {
                    refreshReminders();
                }
            });
        });
        
        // Toggle reminder fields
        document.getElementById('setReminder').addEventListener('change', function() {
            document.getElementById('reminderFields').classList.toggle('hidden', !this.checked);
            // Set default reminder date to today if not already set
            if (this.checked && !document.getElementById('reminderDate').value) {
                document.getElementById('reminderDate').value = formattedDate;
            }
        });
        
        // Highlight selected transaction type
        document.getElementById('cash-option').addEventListener('click', function() {
            document.getElementById('cash').checked = true;
            this.classList.add('bg-green-100');
            document.getElementById('credit-option').classList.remove('bg-red-100');
        });
        
        document.getElementById('credit-option').addEventListener('click', function() {
            document.getElementById('credit').checked = true;
            this.classList.add('bg-red-100');
            document.getElementById('cash-option').classList.remove('bg-green-100');
        });
        
        // Add entry form submission
        document.getElementById('addEntryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const personName = document.getElementById('personName').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const transactionType = document.querySelector('input[name="transactionType"]:checked').value;
            const entryDate = document.getElementById('entryDate').value;
            const category = document.getElementById('category').value;
            const description = document.getElementById('description').value;
            const setReminder = document.getElementById('setReminder').checked;
            
            // Create new entry object
            const newEntry = {
                id: Date.now(), // unique ID
                personName,
                amount,
                transactionType,
                entryDate,
                category,
                description,
                timestamp: new Date().toISOString()
            };
            
            // Add to ledger entries
            ledgerEntries.push(newEntry);
            saveToLocalStorage();
            
            // Add reminder if checked
            if (setReminder) {
                const reminderDate = document.getElementById('reminderDate').value;
                const reminderTime = document.getElementById('reminderTime').value || '09:00';
                
                const reminder = {
                    id: Date.now(),
                    entryId: newEntry.id,
                    personName,
                    amount,
                    transactionType,
                    reminderDate,
                    reminderTime,
                    completed: false
                };
                
                reminders.push(reminder);
                saveRemindersToLocalStorage();
            }
            
            // Reset form
            this.reset();
            document.getElementById('entryDate').value = formattedDate;
            document.getElementById('reminderFields').classList.add('hidden');
            document.getElementById('cash-option').classList.remove('bg-green-100');
            document.getElementById('credit-option').classList.remove('bg-red-100');
            document.getElementById('cash').checked = true;
            
            // Show success message with neubrutalism style
            const successAlert = document.createElement('div');
            successAlert.className = 'fixed top-4 right-4 neubrutalism bg-green-100 p-4 z-50';
            successAlert.innerHTML = `
                <div class="flex items-center">
                    <i class="bi bi-check-circle text-green-500 mr-2"></i>
                    <p>Transaction for ${personName} added successfully!</p>
                </div>
            `;
            document.body.appendChild(successAlert);
            
            // Remove success message after 3 seconds
            setTimeout(() => {
                successAlert.remove();
            }, 3000);
            
            // Refresh transactions if on view tab
            refreshTransactionsTable();
            refreshReminders();
        });
        
        // Filter and search functionality
        document.getElementById('applyFilters').addEventListener('click', function() {
            refreshTransactionsTable();
        });
        
        document.getElementById('searchBtn').addEventListener('click', function() {
            refreshTransactionsTable();
        });
        
        document.getElementById('searchInput').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                refreshTransactionsTable();
            }
        });
        
        document.getElementById('clearFilters').addEventListener('click', function() {
            document.getElementById('searchInput').value = '';
            document.getElementById('financialYear').selectedIndex = 0;
            document.getElementById('filterType').selectedIndex = 0;
            refreshTransactionsTable();
        });
        
        // Generate report button
        document.getElementById('generateReport').addEventListener('click', function() {
            generateMonthlyReport();
        });
        
        // Edit modal functionality
        document.getElementById('closeEditModal').addEventListener('click', closeEditModal);
        document.getElementById('cancelEdit').addEventListener('click', closeEditModal);
        
        document.getElementById('editEntryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('editId').value);
            const personName = document.getElementById('editPersonName').value;
            const amount = parseFloat(document.getElementById('editAmount').value);
            const transactionType = document.querySelector('input[name="editTransactionType"]:checked').value;
            const entryDate = document.getElementById('editEntryDate').value;
            const category = document.getElementById('editCategory').value;
            const description = document.getElementById('editDescription').value;
            
            // Find and update the entry
            const index = ledgerEntries.findIndex(entry => entry.id === id);
            
            if (index !== -1) {
                ledgerEntries[index] = {
                    ...ledgerEntries[index],
                    personName,
                    amount,
                    transactionType,
                    entryDate,
                    category,
                    description,
                    updatedAt: new Date().toISOString()
                };
                
                saveToLocalStorage();
                refreshTransactionsTable();
                generateMonthlyReport();
                
                // Update any associated reminders
                const reminderIndex = reminders.findIndex(r => r.entryId === id);
                if (reminderIndex !== -1) {
                    reminders[reminderIndex] = {
                        ...reminders[reminderIndex],
                        personName,
                        amount,
                        transactionType
                    };
                    saveRemindersToLocalStorage();
                    refreshReminders();
                }
                
                // Show success message
                const successAlert = document.createElement('div');
                successAlert.className = 'fixed top-4 right-4 neubrutalism bg-green-100 p-4 z-50';
                successAlert.innerHTML = `
                    <div class="flex items-center">
                        <i class="bi bi-check-circle text-green-500 mr-2"></i>
                        <p>Transaction updated successfully!</p>
                    </div>
                `;
                document.body.appendChild(successAlert);
                
                setTimeout(() => {
                    successAlert.remove();
                }, 3000);
                
                closeEditModal();
            }
        });
        
        // Initialize charts
        let monthlyChart, balanceChart;
        
        function initializeCharts() {
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            monthlyChart = new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: ['Cash', 'Credit'],
                    datasets: [{
                        label: 'Transactions Amount ($)',
                        data: [0, 0],
                        backgroundColor: ['#10B981', '#EF4444'],
                        borderWidth: 2,
                        borderColor: '#000'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Space Grotesk',
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    family: 'Space Grotesk',
                                    size: 12
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Space Grotesk',
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
            
            const balanceCtx = document.getElementById('balanceChart').getContext('2d');
            balanceChart = new Chart(balanceCtx, {
                type: 'pie',
                data: {
                    labels: ['Cash', 'Credit'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#10B981', '#EF4444'],
                        borderWidth: 3,
                        borderColor: '#000'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: 'Space Grotesk',
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Initialize charts when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadFromLocalStorage();
            refreshTransactionsTable();
            refreshReminders();
            generateMonthlyReport();
        });
        
        // Refresh transactions table
        function refreshTransactionsTable() {
            const table = document.getElementById('transactionsTable');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const financialYear = document.getElementById('financialYear').value;
            const filterType = document.getElementById('filterType').value;
            
            // Clear table content
            table.innerHTML = '';
            
            // Calculate financial year date range (April 1 to March 31)
            const [startYear, endYear] = financialYear.split('-');
            const startDate = new Date(`${startYear}-04-01`);
            const endDate = new Date(`${endYear}-03-31`);
            
            let filteredEntries = ledgerEntries.filter(entry => {
                const entryDate = new Date(entry.entryDate);
                // Filter by financial year
                const inFinancialYear = entryDate >= startDate && entryDate <= endDate;
                
                // Filter by type (cash/credit)
                const matchesType = filterType === 'all' || entry.transactionType === filterType;
                
                // Search term matches
                const searchMatches = searchTerm === '' || 
                    entry.personName.toLowerCase().includes(searchTerm) ||
                    entry.category.toLowerCase().includes(searchTerm) ||
                    entry.description.toLowerCase().includes(searchTerm) ||
                    entry.amount.toString().includes(searchTerm) ||
                    entry.transactionType.toLowerCase().includes(searchTerm);
                
                return inFinancialYear && matchesType && searchMatches;
            });
            
            // Sort by date (newest first)
            filteredEntries.sort((a, b) => new Date(b.entryDate) - new Date(a.entryDate));
            
            if (filteredEntries.length === 0) {
                table.innerHTML = `
                    <tr class="border-b border-gray-200">
                        <td colspan="6" class="p-4 text-center">No transactions found. Try adjusting your filters.</td>
                    </tr>
                `;
                return;
            }
            
            // Add rows to table
            filteredEntries.forEach(entry => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-50';
                
                const formattedDate = new Date(entry.entryDate).toLocaleDateString();
                const typeClass = entry.transactionType === 'cash' ? 'bg-green-100' : 'bg-red-100';
                
                row.innerHTML = `
                    <td class="p-3">${formattedDate}</td>
                    <td class="p-3">${entry.personName}</td>
                    <td class="p-3">$${entry.amount.toFixed(2)}</td>
                    <td class="p-3"><span class="px-2 py-1 rounded ${typeClass} font-bold">${entry.transactionType}</span></td>
                    <td class="p-3">${entry.category}</td>
                    <td class="p-3">
                        <button onclick="editEntry(${entry.id})" class="neubrutalism bg-blue-400 text-white p-1 mr-2">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button onclick="deleteEntry(${entry.id})" class="neubrutalism bg-red-400 text-white p-1">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                
                table.appendChild(row);
            });
        }
        
        // Generate monthly report
        function generateMonthlyReport() {
            const selectedMonth = parseInt(document.getElementById('reportMonth').value);
            const selectedYear = parseInt(document.getElementById('reportYear').value);
            
            // Filter entries for the selected month and year
            const filteredEntries = ledgerEntries.filter(entry => {
                const entryDate = new Date(entry.entryDate);
                return entryDate.getMonth() === selectedMonth && entryDate.getFullYear() === selectedYear;
            });
            
            // Calculate totals
            let totalCash = 0;
            let totalCredit = 0;
            
            filteredEntries.forEach(entry => {
                if (entry.transactionType === 'cash') {
                    totalCash += entry.amount;
                } else if (entry.transactionType === 'credit') {
                    totalCredit += entry.amount;
                }
            });
            
            // Update charts
            monthlyChart.data.datasets[0].data = [totalCash, totalCredit];
            monthlyChart.update();
            
            balanceChart.data.datasets[0].data = [totalCash, totalCredit];
            balanceChart.update();
            
            // Update statistics
            document.getElementById('totalTransactions').textContent = filteredEntries.length;
            document.getElementById('totalCash').textContent = `$${totalCash.toFixed(2)}`;
            document.getElementById('totalCredit').textContent = `$${totalCredit.toFixed(2)}`;
            
            // Show no data message if no entries
            if (filteredEntries.length === 0) {
                const noDataAlert = document.createElement('div');
                noDataAlert.className = 'fixed top-4 right-4 neubrutalism bg-yellow-100 p-4 z-50';
                noDataAlert.innerHTML = `
                    <div class="flex items-center">
                        <i class="bi bi-info-circle text-yellow-500 mr-2"></i>
                        <p>No data available for ${document.getElementById('reportMonth').options[selectedMonth].text} ${selectedYear}</p>
                    </div>
                `;
                document.body.appendChild(noDataAlert);
                
                setTimeout(() => {
                    noDataAlert.remove();
                }, 3000);
            }
        }
        
        // Refresh reminders list
        function refreshReminders() {
            const container = document.getElementById('remindersContainer');
            const completedContainer = document.getElementById('completedRemindersContainer');
            container.innerHTML = '';
            completedContainer.innerHTML = '';
            
            // Sort reminders by date (closest first)
            const pendingReminders = reminders
                .filter(r => !r.completed)
                .sort((a, b) => {
                    const dateA = new Date(`${a.reminderDate}T${a.reminderTime}`);
                    const dateB = new Date(`${b.reminderDate}T${b.reminderTime}`);
                    return dateA - dateB;
                });
                
            // Sort completed reminders (newest completions first)
            const completedRemindersArray = reminders
                .filter(r => r.completed)
                .sort((a, b) => {
                    const dateA = new Date(`${a.reminderDate}T${a.reminderTime}`);
                    const dateB = new Date(`${b.reminderDate}T${b.reminderTime}`);
                    return dateB - dateA;
                });
            
            if (pendingReminders.length === 0) {
                container.innerHTML = `
                    <div class="neubrutalism bg-yellow-50 p-4">
                        <p class="text-center">No reminders set. Add a transaction with a reminder to see it here!</p>
                    </div>
                `;
            } else {
                pendingReminders.forEach(reminder => {
                    const reminderDate = new Date(`${reminder.reminderDate}T${reminder.reminderTime}`);
                    const isPast = reminderDate < new Date();
                    const bgColor = isPast ? 'bg-red-100' : 'bg-yellow-50';
                    
                    const reminderEl = document.createElement('div');
                    reminderEl.className = `neubrutalism ${bgColor} p-4`;
                    
                    reminderEl.innerHTML = `
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h4 class="font-bold text-lg">${reminder.personName} - ${reminder.transactionType}</h4>
                                <p class="font-semibold">Amount: $${reminder.amount.toFixed(2)}</p>
                                <p class="${isPast ? 'text-red-600 font-bold' : ''}">
                                    ${isPast ? 'OVERDUE: ' : ''}Due: ${reminderDate.toLocaleDateString()} at ${reminderDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                </p>
                            </div>
                            <div class="flex gap-2 w-full md:w-auto">
                                <button onclick="markReminderComplete(${reminder.id})" class="neubrutalism bg-green-500 text-white px-3 py-2 w-full md:w-auto">
                                    <i class="bi bi-check-circle"></i> Mark Complete
                                </button>
                                <button onclick="deleteReminder(${reminder.id})" class="neubrutalism bg-red-500 text-white px-3 py-2">
                                    <i class="bi bi-x-circle"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(reminderEl);
                });
            }
            
            if (completedRemindersArray.length === 0) {
                completedContainer.innerHTML = `
                    <div class="neubrutalism bg-green-50 p-4">
                        <p class="text-center">No completed reminders yet.</p>
                    </div>
                `;
            } else {
                completedRemindersArray.slice(0, 5).forEach(reminder => { // Show only 5 most recent completions
                    const reminderDate = new Date(`${reminder.reminderDate}T${reminder.reminderTime}`);
                    
                    const reminderEl = document.createElement('div');
                    reminderEl.className = `neubrutalism bg-green-50 p-4`;
                    
                    reminderEl.innerHTML = `
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <div>
                                <h4 class="font-bold text-lg">${reminder.personName} - ${reminder.transactionType}</h4>
                                <p>Amount: $${reminder.amount.toFixed(2)}</p>
                                <p>Original Due: ${reminderDate.toLocaleDateString()}</p>
                            </div>
                            <div>
                                <span class="inline-block bg-green-200 px-2 py-1 rounded">
                                    <i class="bi bi-check-circle-fill text-green-600"></i> Completed
                                </span>
                            </div>
                        </div>
                    `;
                    
                    completedContainer.appendChild(reminderEl);
                });
            }
        }
        
        // Edit Modal Functions
        function openEditModal(entry) {
            document.getElementById('editId').value = entry.id;
            document.getElementById('editPersonName').value = entry.personName;
            document.getElementById('editAmount').value = entry.amount;
            document.getElementById(entry.transactionType === 'cash' ? 'editCash' : 'editCredit').checked = true;
            document.getElementById('editEntryDate').value = entry.entryDate;
            document.getElementById('editCategory').value = entry.category;
            document.getElementById('editDescription').value = entry.description;
            
            document.getElementById('editModal').classList.remove('hidden');
        }
        
        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
        }
        
        // Edit and Delete functions
        function editEntry(id) {
            const entry = ledgerEntries.find(e => e.id === id);
            if (!entry) return;
            
            openEditModal(entry);
        }
        
        function deleteEntry(id) {
            // Create a confirmation modal with neubrutalism style
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmModal.innerHTML = `
                <div class="neubrutalism bg-white p-6 max-w-sm w-full">
                    <h3 class="text-xl font-bold mb-4">Confirm Deletion</h3>
                    <p class="mb-6">Are you sure you want to delete this transaction? This cannot be undone.</p>
                    <div class="flex justify-end gap-4">
                        <button id="cancelDelete" class="neubrutalism bg-gray-200 px-4 py-2">Cancel</button>
                        <button id="confirmDelete" class="neubrutalism bg-red-500 text-white px-4 py-2">Delete</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmModal);
            
            document.getElementById('cancelDelete').addEventListener('click', () => {
                document.body.removeChild(confirmModal);
            });
            
            document.getElementById('confirmDelete').addEventListener('click', () => {
                // Remove the entry
                ledgerEntries = ledgerEntries.filter(e => e.id !== id);
                saveToLocalStorage();
                
                // Also delete any associated reminders
                reminders = reminders.filter(r => r.entryId !== id);
                saveRemindersToLocalStorage();
                
                refreshTransactionsTable();
                refreshReminders();
                generateMonthlyReport();
                
                // Show deletion success message
                const deleteAlert = document.createElement('div');
                deleteAlert.className = 'fixed top-4 right-4 neubrutalism bg-green-100 p-4 z-50';
                deleteAlert.innerHTML = `
                    <div class="flex items-center">
                        <i class="bi bi-check-circle text-green-500 mr-2"></i>
                        <p>Transaction deleted successfully!</p>
                    </div>
                `;
                document.body.appendChild(deleteAlert);
                
                setTimeout(() => {
                    deleteAlert.remove();
                }, 3000);
                
                document.body.removeChild(confirmModal);
            });
        }
        
        function markReminderComplete(id) {
            const reminderIndex = reminders.findIndex(r => r.id === id);
            if (reminderIndex !== -1) {
                reminders[reminderIndex].completed = true;
                saveRemindersToLocalStorage();
                refreshReminders();
                
                // Show success message
                const completedAlert = document.createElement('div');
                completedAlert.className = 'fixed top-4 right-4 neubrutalism bg-green-100 p-4 z-50';
                completedAlert.innerHTML = `
                    <div class="flex items-center">
                        <i class="bi bi-check-circle text-green-500 mr-2"></i>
                        <p>Reminder marked as complete!</p>
                    </div>
                `;
                document.body.appendChild(completedAlert);
                
                setTimeout(() => {
                    completedAlert.remove();
                }, 3000);
            }
        }
        
        function deleteReminder(id) {
            reminders = reminders.filter(r => r.id !== id);
            saveRemindersToLocalStorage();
            refreshReminders();
        }
        
        // Local Storage functions
        function saveToLocalStorage() {
            localStorage.setItem('ledgerEntries', JSON.stringify(ledgerEntries));
        }
        
        function saveRemindersToLocalStorage() {
            localStorage.setItem('ledgerReminders', JSON.stringify(reminders));
        }
        
        function loadFromLocalStorage() {
            const savedEntries = localStorage.getItem('ledgerEntries');
            const savedReminders = localStorage.getItem('ledgerReminders');
            
            if (savedEntries) {
                ledgerEntries = JSON.parse(savedEntries);
            }
            
            if (savedReminders) {
                reminders = JSON.parse(savedReminders);
            }
        }
        
        // Original MediPartners functionality
        function downloadPartnersList() {
            const partners = [
                "MediTech Solutions - Surgical Equipment",
                "HealthCare Plus - Pharmaceutical Supplies",
                "BioMed Corp - Diagnostic Equipment",
                "LifeScience Labs - Research Equipment",
                "CarePlus Medical - Patient Care Products"
            ];
            
            const content = partners.join('\n');
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'medical_partners.txt';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            // Show download success message
            const downloadAlert = document.createElement('div');
            downloadAlert.className = 'fixed top-4 right-4 neubrutalism bg-green-100 p-4 z-50';
            downloadAlert.innerHTML = `
                <div class="flex items-center">
                    <i class="bi bi-check-circle text-green-500 mr-2"></i>
                    <p>Partners list downloaded successfully!</p>
                </div>
            `;
            document.body.appendChild(downloadAlert);
            
            setTimeout(() => {
                downloadAlert.remove();
            }, 3000);
        }

        document.getElementById('contactForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show success message
            const contactAlert = document.createElement('div');
            contactAlert.className = 'fixed top-4 right-4 neubrutalism bg-green-100 p-4 z-50';
            contactAlert.innerHTML = `
                <div class="flex items-center">
                    <i class="bi bi-check-circle text-green-500 mr-2"></i>
                    <p>Thank you for your message! We will get back to you soon.</p>
                </div>
            `;
            document.body.appendChild(contactAlert);
            
            setTimeout(() => {
                contactAlert.remove();
            }, 3000);
            
            this.reset();
        });
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>